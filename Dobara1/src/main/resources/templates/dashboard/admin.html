<!DOCTYPE html>
<html lang="en" xmlns:th="http://thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1, initial-scale=1.0">
    <title>Document</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">


    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
           --primary-color: #00A859;
           --secondary-color: #007A43;
           --accent-color: #FF6B35;
           --dark-color: #2C3E50;
           --light-bg: #F8F9FA;
       }
       body {
           font-family: 'Lato', sans-serif;
           font-size: 0.9rem;
       }

       .sidebar {
           position: fixed;
           top: 0;
           bottom: 0;
           left: 0;
           z-index: 100;
           padding: 70px 0 0;
           box-shadow: inset -1px 0 0 rgba(0, 0, 0, 0.1);
           min-height: 100vh;
       }

       .sidebar .nav-link {
           font-weight: 500;
           color: #333;
           font-weight: bold;
           padding: 0.75rem 1rem;
           margin: 0.125rem 0;
           border-radius: 0.375rem;
           transition: all 0.3s ease;
       }

     .sidebar .nav-link:hover,
        .sidebar .nav-link.active {
            color: var(--primary-color);
            background-color: rgba(13, 110, 253, 0.06);
        }

       .sidebar .nav-link i {
           margin-right: 0.5rem;
       }

          .navbar-brand {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--primary-color) !important;
        }

       .dashboard-section {
           display: none;
       }

       .dashboard-section.active {
           display: block;
       }

<!--        vaishnavi code  -->

   .product-card {
     border-radius: 15px;
     overflow: hidden;
     box-shadow: 0 4px 12px rgba(0,0,0,0.1);
     transition: transform 0.2s ease, box-shadow 0.2s ease;
     height: 100%;
   }
   .product-card:hover {
     transform: translateY(-5px);
     box-shadow: 0 6px 18px rgba(0,0,0,0.15);
   }
   .carousel-inner img {
     height: 200px;
     object-fit: cover;
   }
   .price-tag {
     font-size: 1.25rem;
     font-weight: bold;
     color: green;
   }

<!--        ends here -->


    </style>

</head>

<body>

<nav class="navbar navbar-dark sticky-top bg-light flex-md-nowrap p-2 shadow">
    <div class="container-fluid">
        <a class="navbar-brand d-flex align-items-center" href="#">
<!--            <img src="../images/wallpaper.jpg" alt="Logo"-->
<!--                 style="width:50px; height:50px; border-radius:50%; object-fit:cover; ">-->
            <span style="color:black;">
                 <i class="fas fa-store-alt"></i> Mini Market
<!--                    <i class="bi bi-person me-1"></i>-->
<!--                    <span th:text="${user_master.name}"></span>-->
                </span>
        </a>
        <div class="d-flex align-items-center">
            <div class="dropdown">
                <a href="#" class="d-flex align-items-center text-decoration-none dropdown-toggle" id="dropdownUser"
                   data-bs-toggle="dropdown">
                    <img th:if="${user_master.profile_pic != null}" th:src="@{/userphoto}"
                         class="rounded-circle me-2" width="40" height="40">
                    <div th:unless="${user_master.profile_pic != null}">
                        <i class="fas fa-user-circle rounded-circle me-2 fs-1"></i>
                    </div>
                    <span class="d-none d-sm-inline text-dark" th:text="${user_master.name}"></span>
                </a>
                <ul class="dropdown-menu dropdown-menu-end">

                    <li><a class="dropdown-item" th:href="@{/logout}" onclick="confirmLogout(event)">
                        <i class="fas fa-sign-in-alt me-2"></i>Sign out
                        </a></li>
                </ul>
            </div>
        </div>
        <button class="btn btn-outline-light d-md-none me-2" type="button" data-bs-toggle="collapse"
                data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false"
                aria-label="Toggle navigation">
            <span style="color:black"><i class="bi bi-list"></i></span>
        </button>
    </div>
</nav>
<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse bg-white">
            <div class="position-sticky pt-3">
                <ul class="nav flex-column">
                    <li class="nav-item"><a class="nav-link active" href="#home"><i
                            class="bi bi-house me-2"></i>Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="#show-all-items"><i
                            class="bi bi-people me-2"></i>Show All Items</a>
                    </li>
                    <li class="nav-item"><a class="nav-link" href="#show-all-user">
                        <i class="bi bi-people me-2"></i>show all user</a></li>
                    <li class="nav-item"><a class="nav-link" href="#profile"><i
                            class="bi bi-mortarboard me-2"></i>Profile</a></li>
                    <li class="nav-item"><a class="nav-link" href="#feedback"><i
                            class="bi bi-book me-2"></i>Feedback Review</a></li>
                    <li class="nav-item"><a class="nav-link" href="#logout" onclick="confirmLogout(event)"><i
                            class="bi bi-folder2-open me-2"></i>logout</a></li>
                    <!-- <li class="nav-item"><a class="nav-link" href="#message-part"><i
                                class="bi bi-chat-dots me-2"></i>Offers</a></li> -->
                </ul>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">

            <div class="row my-4">
<!--                <div id="home" class="dashboard-section">-->
<!--&lt;!&ndash;                    <h2 class="mt-3">Admin Dashboard</h2>&ndash;&gt;-->

<!--                    Home page code starts here -->

                    <!-- ================= HOME SECTION ================= -->
                    <div id="home" class="dashboard-section active">
                        <h3 class="fw-bold mb-4 text-center">Home</h3>

                        <!-- ====== Top Summary Cards ====== -->
                        <div class="row g-4 mb-4">
                            <div class="col-md-4">
                                <div class="card text-center p-4 shadow-sm">
                                    <i class="bi bi-people card-icon text-primary fs-1 mb-2"></i>
                                    <h5>Total Users</h5>
                                    <h2 th:text="${allusers.size()}">0</h2>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="card text-center p-4 shadow-sm">
                                    <i class="bi bi-box-seam card-icon text-success fs-1 mb-2"></i>
                                    <h5>Total Items</h5>
                                    <h2 th:text="${totalItems}">0</h2>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="card text-center p-4 shadow-sm">
                                    <i class="bi bi-person-check card-icon text-success fs-1 mb-2"></i>
                                    <h5>Active Users</h5>
                                    <h2 th:text="${activeUsers.size()}">0</h2>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="card text-center p-4 shadow-sm">
                                    <i class="bi bi-person-check card-icon text-warning fs-1 mb-2"></i>
                                    <h5>Inactive Users</h5>
                                    <h2 th:text="${inactiveUsers.size()}">0</h2>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="card text-center p-4 shadow-sm">
                                    <i class="bi bi-person-slash card-icon text-danger fs-1 mb-2"></i>
                                    <h5>Archived Users</h5>
                                    <h2 th:text="${archivedUsers.size()}">0</h2>
                                </div>
                            </div>
                        </div>

                        <!-- ====== Filter Buttons ====== -->
                        <div class="text-start mb-4">
                            <button class="btn btn-outline-success fw-semibold shadow-sm me-2 mb-2" id="activeBtn">
                                <i class="bi bi-person-check-fill me-1"></i> Active Users
                            </button>
                            <button class="btn btn-outline-warning fw-semibold shadow-sm me-2 mb-2" id="inactiveBtn">
                                <i class="bi bi-person-dash-fill me-1"></i> Inactive Users
                            </button>
                            <button class="btn btn-outline-danger fw-semibold shadow-sm mb-2" id="archivedBtn">
                                <i class="bi bi-archive-fill me-1"></i> Archived Users
                            </button>
                        </div>

                        <!-- ====== Active Users Table ====== -->
                        <div id="activeTable" class="user-table d-none">
                            <h4 class="text-success fw-bold text-center mb-3">Active Users</h4>
                            <div class="table-responsive">
                                <table class="table table-striped table-hover align-middle text-center">
                                    <thead class="table-success">
                                    <tr>
                                        <th>Name</th>
                                        <th>Email</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr th:each="user : ${activeUsers}">
                                        <td th:text="${user.name}">John Doe</td>
                                        <td th:text="${user.email}">john@example.com</td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- ====== Inactive Users Table ====== -->
                        <div id="inactiveTable" class="user-table d-none">
                            <h4 class="text-warning fw-bold text-center mb-3">Inactive Users</h4>
                            <div class="table-responsive">
                                <table class="table table-striped table-hover align-middle text-center">
                                    <thead class="table-warning">
                                    <tr>
                                        <th>Name</th>
                                        <th>Email</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr th:each="user : ${inactiveUsers}">
                                        <td th:text="${user.name}">John Doe</td>
                                        <td th:text="${user.email}">john@example.com</td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- ====== Archived Users Table ====== -->
                        <div id="archivedTable" class="user-table d-none">
                            <h4 class="text-danger fw-bold text-center mb-3">Archived Users</h4>
                            <div class="table-responsive">
                                <table class="table table-striped table-hover align-middle text-center">
                                    <thead class="table-danger">
                                    <tr>
                                        <th>Name</th>
                                        <th>Email</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr th:each="user : ${archivedUsers}">
                                        <td th:text="${user.name}">John Doe</td>
                                        <td th:text="${user.email}">john@example.com</td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <script>
                        const activeBtn = document.getElementById('activeBtn');
                        const inactiveBtn = document.getElementById('inactiveBtn');
                        const archivedBtn = document.getElementById('archivedBtn');

                        const activeTable = document.getElementById('activeTable');
                        const inactiveTable = document.getElementById('inactiveTable');
                        const archivedTable = document.getElementById('archivedTable');

                        function showTable(table) {
                          [activeTable, inactiveTable, archivedTable].forEach(t => t.classList.add('d-none'));
                          table.classList.remove('d-none');
                        }

                        activeBtn.addEventListener('click', () => showTable(activeTable));
                        inactiveBtn.addEventListener('click', () => showTable(inactiveTable));
                        archivedBtn.addEventListener('click', () => showTable(archivedTable));
                    </script>


                    <!--                    Home page code ends here -->
<!--                </div>-->

                <!-- Reporting Part of Items.-->
                <div id="show-all-items" class="dashboard-section">
                    <h3>show all items</h3>

                    <div class="container mt-5">
                        <div class="row">
<!--                            Item card code-->
                            <div class="col-md-4 mb-4" th:each="listing , iter:${listdata}">
                                <div class="card shadow-sm position-relative">
<!--                                    carousel-->
                                    <div th:id="'carousel' +${iter.index}" class="carousel slide"
                                    data-bs-ride="carousel">
                                        <div class="carousel-inner">
                                            <div class="carousel-item"
                                            th:each="img, imgStat : ${listing.images}"
                                            th:class="'carousel-item' + (${imgStat.index} == 0 ? ' active' : '')">
                                                <img th:src="@{'/images/' + ${img.id}}"
                                                class="d-block w-100 carousel-img" alt="Item 1 images">
                                            </div>
                                        </div>
                                        <button class="carousel-control-prev" type="button"
                                        th:attr="data-bs-target='#carousel' +${iter.index}"
                                        data-bs-slide="prev">
                                            <span class="carousel-control-prev-icon"></span>
                                        </button>
                                        <button class="carousel-control-next" type="button"
                                                th:attr="data-bs-target='#carousel' + ${iter.index}"
                                                data-bs-slide="next">
                                            <span class="carousel-control-next-icon"></span>
                                        </button>
                                    </div>
<!--                                    Details-->
                                    <div class="card-body">
                                        <h5 class="card-title">
                                            <span th:text="${listing.companyName}"></span>
                                        </h5>
                                        <p class="card-text"><strong>Price:</strong> â‚¹<span
                                        th:text="${listing.price}"></span></p>
                                        <p class="card-text"><strong>Color:</strong> <span
                                                th:text="${listing.color}"></span></p>
                                        <p class="card-text"><strong>Condition:</strong> <span
                                                th:text="${listing.condition}"></span></p>
                                        <p class="card-text "><strong>Description: </strong><span
                                                th:text="${listing.description}"></span></p>
                                        <div class="d-flex gap-2 mt-2">


                                            <!-- Delete Button -->
                                            <button type="button" class="btn btn-danger flex-fill"
                                                    data-bs-toggle="modal"
                                                    th:attr="data-bs-target='#removeModal' + ${listing.id}">
                                                <i class="bi bi-trash3-fill me-1"></i>Report Item
                                            </button>
                                        </div>

                                    </div>
                                </div>
<!--                                3 div shift-->


<!--                    Modal code-->

                    <!-- Remove Item Modal -->
<!--                    th:id="'removeModal' + ${iter.index}" -->
                    <div class="modal fade" th:id="'removeModal' + ${listing.id}" tabindex="-1" aria-labelledby="removeModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header bg-danger text-white">
                                    <h5 class="modal-title" id="removeModalLabel">Confirm Item Removal</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <form th:action="@{/admin/reportitem}" method="post">
                                    <div class="modal-body">
                                        <p>Are you sure you want to remove
                                            <strong th:text="${listing.description}"></strong>?
                                        </p>
                                        <input type="hidden" name="itemId" th:value="${listing.id}">
                                        <div class="mb-3">
                                            <label for="reason" class="form-label">Reason for Removal</label>
                                            <textarea class="form-control" id="reason" name="reason" rows="3" placeholder="Write your reason here..." required></textarea>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                        <button type="submit" class="btn btn-danger">Report Item</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                            </div>
                        </div>
                    </div>
<!--Modal code ends here.-->

                </div>
<!--                Reporting part end here.-->

<!--                show all user like buyer / seller part is here-->
                <div id="show-all-user" class="dashboard-section">
<!--                    <h1>This is a Div</h1>-->
                    <div class="container mt-5">
<!--                        <h3 class="mb-4">All Users</h3>-->
                        <div class="table-responsive">
                            <table class="table table-hover align-middle">
                                <thead class="table-light">
                                <tr>
                                    <th>#</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Action</th>
                                </tr>
                                </thead>
                                <tbody>
                                <!-- Loop over users from backend -->
                                <tr th:each="user, iterStat : ${allusers}">
                                    <td th:text="${iterStat.index + 1}"></td>
                                    <td th:text="${user.name}"></td>
                                    <td th:text="${user.email}"></td>
                                    <td>
                                        <a th:href="@{'/user/profile/' + ${user.id}}"
                                           class="btn btn-success btn-sm">
                                            View Profile
                                        </a>
                                    </td>
                                </tr>

                                <!-- Optional: show if no users -->
                                <tr th:if="${#lists.isEmpty(users)}">
                                    <td colspan="4" class="text-center text-muted">
                                        No users found.
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                </div>
<!--               show all user like buyer / seller part ends here -->


<!--                Feedback Review code starts here.-->

                <div class="container py-5 dashboard-section" id="feedback">
                    <h2 class="text-center mb-4">ðŸ“‹ User Feedback</h2>

                    <!-- No feedback case -->
                    <div class="row g-4" th:if="${#lists.isEmpty(feedbacks)}">
                        <div class="col-12 text-center text-muted">
                            <p>No feedback submitted yet.</p>
                        </div>
                    </div>

                    <!-- Feedback list (2 cards per row) -->
                    <div class="row g-4" th:if="${!#lists.isEmpty(feedbacks)}">
                        <div class="col-md-6" th:each="feedback : ${feedbacks}">
                            <div class="card shadow-sm h-100">
                                <div class="card-body">

                                    <!-- Highlight offensive feedback -->
                                    <span class="badge"
                                          th:classappend="${feedback.offensive != null and feedback.offensive != ''} ? 'bg-danger' : 'bg-secondary'">
                        <span th:text="${feedback.offensive != null and feedback.offensive != '' ? 'Offensive' : 'General'}"></span>
                    </span>

                                    <h5 class="card-title mt-2">
                                        <i class="bi bi-person-circle me-1"></i>
                                        <span th:text="${feedback.user.name}">User Name</span>
                                    </h5>

                                    <p class="mb-1"><strong>Email:</strong>
                                        <span th:text="${feedback.user.email}">user@example.com</span>
                                    </p>
                                    <p class="mb-1"><strong>Rating:</strong>
                                        <span th:text="${feedback.rating}">Good</span>
                                    </p>
                                    <p class="mb-2"><strong>Comments:</strong>
                                        <span th:text="${feedback.comments}">Great experience!</span>
                                    </p>

                                    <p class="mb-0 text-muted small">
                                        <strong>Date:</strong>
                                        <span th:text="${#temporals.format(feedback.date, 'dd MMM yyyy')}">12 Oct 2025</span>
                                    </p>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!--                Feedback review code ends here .-->

<!--                Profile edit code -->

                <div id="profile" class="dashboard-section" th:classappend="${activeTab}=='profile' ? 'active'">
<!--                    <h2>Profile section.</h2>-->

                    <div class="container py-5">
                        <div class="card shadow-lg border-0 rounded-4 mx-auto p-4" style="max-width: 840px;">
                            <form th:action="@{/updateprofileadmin}" method="put">

                                <!-- PROFILE IMAGE SECTION -->
                                <div class="text-center mb-4">
                                    <img th:if="${user_master.profile_pic != null}" th:src="@{/userphoto}"
                                         alt="Profile Picture"
                                         class="rounded-circle border border-3 border-primary img-fluid"
                                         style="width: 180px; height: 180px; object-fit: cover;">
                                    <div th:unless="${user_master.profile_pic != null}">
                                        <i class="bi bi-person-circle text-primary" style="font-size: 100px;"></i>
                                    </div>
                                    <h4 class="mt-3 fw-semibold">Admin Profile</h4>
                                </div>

                                <!-- PROFILE INFO SECTION -->
                                <div class="px-3">
                                    <h4 class="fw-bold mb-4 text-primary text-center">Profile Information</h4>

                                    <div class="row">
                                        <div class=" col-lg-6 mb-3">
                                            <label class="form-label fw-bold">Name</label>
                                            <input type="text" class="form-control" th:value="${user_master.name}" name="name">
                                        </div>

                                        <div class="col-lg-6 mb-3">
                                            <label class="form-label fw-bold">Email</label>
                                            <input type="email" class="form-control" th:value="${user_master.email}" name="email">
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-6 mb-3">
                                            <label class="form-label fw-bold">Address</label>
                                            <input type="text" class="form-control" th:value="${user_master.address}" name="address">
                                        </div>

                                        <div class="col-lg-6 mb-3">
                                            <label class="form-label fw-bold">Contact</label>
                                            <input type="text" class="form-control" th:value="${user_master.contact}" name="contact">
                                        </div>
                                    </div>
                                    <!-- BUTTONS -->
                                    <div class="d-flex justify-content-end gap-3 mt-4">
                                        <button type="reset" class="btn btn-outline-secondary px-4">Reset</button>
                                        <button type="submit" class="btn btn-success px-4">Update</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>

                </div>
<!--                profile edit code ends here.-->



            </div>

        </main>
    </div>
</div>




<!-- Preview Script -->
<script>
    const input = document.getElementById('productImages');
    const preview = document.querySelector('.preview');

    input.addEventListener('change', () => {
        preview.innerHTML = "";
        Array.from(input.files).forEach(file => {
            const reader = new FileReader();
            reader.onload = e => {
                const img = document.createElement('img');
                img.src = e.target.result;
                preview.appendChild(img);
            }
            reader.readAsDataURL(file);
        });
    });
</script>


<!--Tab related script-->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const navLinks = document.querySelectorAll('.sidebar .nav-link');
        const sections = document.querySelectorAll('.dashboard-section');

        navLinks.forEach(link => {
            link.addEventListener('click', function (e) {
                e.preventDefault();
                navLinks.forEach(l => l.classList.remove('active'));
                this.classList.add('active');
                sections.forEach(section => section.classList.remove('active'));
                const targetId = this.getAttribute('href').substring(1);
                document.getElementById(targetId).classList.add('active');
            });
        });
    });
</script>


<!--Logout script-->

<script>
    function confirmLogout(event) {
        event.preventDefault(); // stops default navigation
        const confirmed = confirm("Are you sure you want to log out?");
        if (confirmed) {
            window.location.href = '/logout'; // call your mapping
        }
    }
</script>







<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>


</body>

</html>
